!function(t){function e(){Trello.authorize(c)}function o(){Trello.authorize(u)}function r(){s.authToTrelloForm.shutdown(null)}function l(){localStorage.clear(),alert("Trello authentication failed!")}function a(){s.exportToTrelloForm=new i.Views.ExportToTrelloForm}function n(){localStorage.clear(),s.authToTrelloForm=new i.Views.AuthToTrelloForm}var i={Views:{},Models:{},Collection:{},Templates:{}},s={};i.Templates.export_to_trello_form='     <form id="export_to_trello_form"> 	<label>Which Board do you want to export to?</label> 	<select id="board_to_export_to" required> 	<% _.each(boards, function(board) { %> 	<option value="<%= board.id %>"><%= board.name %></option> 	<% }); %> 	</select><br><br> 	<input id="export_to_trello_form_submit" type="button" value="Export">  	</form><br> 	',i.Views.ExportToTrelloForm=Backbone.View.extend({initialize:function(){this.model=new Backbone.Model({}),this.model.set("form_id","#export_to_trello_form"),_.bindAll(this,"exportToTrelloSubmit"),this.getBoards()},getBoards:function(){var t=this,e=function(e){var o=_.filter(e,function(t){return!t.closed&&0!=t.lists.size});0==o.size?shutdown("No boards avaliable!"):(t.model.set("boards",o),t.render())},o=function(){t.shutdown("Something went wrong with Trello!")};Trello.members.get("me/boards",{lists:"all"},e,o)},template:_.template(i.Templates.export_to_trello_form),render:function(){return this.$el.html(this.template(this.model.attributes)),t("#export_to_trello").append(this.el),this},events:{"click #export_to_trello_form_submit":"exportToTrelloSubmit"},exportToTrelloSubmit:function(){var e=t("#board_to_export_to option:selected").index(),o=this.model.get("boards")[e].lists[0].id,r=0,l=[],a=this;t("input:checked").each(function(){for(var e=t(this).closest("tr").attr("id"),o=0;o<notes.length;o++)e==notes[o].id&&l.push(notes[o])}),0==l.length?alert("Nothing selected for export"):(console.log("notes: "+JSON.stringify(l)),_.each(l,function(t){Trello.post("cards",{name:t.text,desc:feedback_note_ajax_script.site_url+"?p="+t.post_id+"#feedbacknote="+t.id,idList:o},function(){r+=1,r==l.length&&a.successExport(l)},function(){a.failExport()})}))},successExport:function(e){alert("Successfull export to Trello!"),t.post(feedback_note_ajax_script.feedback_note_ajax_url,{action:"feedback_api_update_export",notes:JSON.stringify(e)},function(t){var e=JSON.parse(t);0==e.status?location.reload():alert("Couldn't update note export date!")})},failExport:function(){shutdown("Trello export failed.")},shutdown:function(t){localStorage.clear(),s.exportToTrelloForm=null,alert(t),s.authToTrelloForm=new i.Views.AuthToTrelloForm,this.removeView()},removeView:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove()}}),i.Templates.auth_to_trello_form=' <form id="auth_to_trello_form"> <input id="auth_to_trello_form_submit" type="button" value="Export"> </form><br> ',i.Views.AuthToTrelloForm=Backbone.View.extend({initialize:function(){_.bindAll(this,"authActiveToTrelloSubmit"),this.render()},template:_.template(i.Templates.auth_to_trello_form),render:function(){return this.$el.html(this.template()),t("#export_to_trello").append(this.el),this},events:{"click #auth_to_trello_form_submit":"authActiveToTrelloSubmit"},authActiveToTrelloSubmit:function(){e()},shutdown:function(t){s.authToTrelloForm=null,null!=t&&alert(t),s.exportToTrelloForm=new i.Views.ExportToTrelloForm,this.removeView()},removeView:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove()}});var c={type:"popup",name:"FeedbackNote",scope:{read:!0,write:!0,account:!1},success:r,error:l},u={type:"popup",name:"FeedbackNote",scope:{read:!0,write:!0,account:!1},interactive:!1,success:a,error:n};t(document).ready(function(){t("#select_project_managing_tool_button").click(function(){"basecamp"==t("#select_tool").val()?(t("#export_to_trello").hide(),t("#export_to_basecamp").show()):(t("#export_to_basecamp").hide(),t("#export_to_trello").show())}),t("#export_to_basecamp_form_submit").click(function(){var e=t("#board_basecamp").val(),o=[];t("input:checked").each(function(){for(var e=t(this).closest("tr").attr("id"),r=0;r<notes.length;r++)e==notes[r].id&&o.push(notes[r])}),0==o.length?alert("Nothing selected for export"):t.post(feedback_note_ajax_script.feedback_note_ajax_url,{action:"feedback_basecamp_export",boardid:e,notes:JSON.stringify(o)},function(t){var e=JSON.parse(t);0==e.status?(alert("Successfull export to Basecamp!"),location.reload()):alert("Couldn't export to basecamp!")})}),t("tr").not(":first").hover(function(){"rgb(0, 128, 0)"!=t(this).css("background-color")&&t(this).css("background-color","#D7D7D7")},function(){"rgb(0, 128, 0)"!=t(this).css("background-color")&&t(this).css("background-color","")}),t(".status_note").click(function(){var e=t(this).attr("id"),o=t("#"+e),r=t(this).closest("tr");t.post(feedback_note_ajax_script.feedback_note_ajax_url,{action:"feedback_admin_done",id:e.replace("status_note_",""),status:o.val()},function(t){var e=JSON.parse(t);0==e.status?(o.val("DONE"),r.css("background-color","")):(o.val("NOT DONE"),r.css("background-color","#008000"))})}),t("#check_note").click(function(){var e=this.checked;t(":checkbox").prop("checked",e)}),o()}),t(document).ready(function(){t("#feedbacknote").tablesorter({theme:"blue",headers:{".sorter-false":{sorter:!1}}}),t("a.popup-open").on("click",function(){var e=t(this).attr("href"),o=t(this).data("width"),r=t(this).data("height"),l="FeedbackNote",a="menubar=1,resizable=1,width="+o+",height="+r;window.open(e,l,a)})})}(jQuery);